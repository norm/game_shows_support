#!/usr/bin/env bash -euo pipefail
#
# Collect the raw footage.

mapfile -t captures < <(ls "$CAPTURE_DIR/"*mkv 2>/dev/null)

for capture in "${captures[@]}"; do
    file="$(basename "$capture")"
    [ "$file" = '*mkv' ] && break

    escaped="$(echo "$capture" | sed -e 's/ /\\ /g')"
    status "++ {green}$file"
    if [ -z "${DRY_RUN:-}" ]; then
        rsync \
            --perms \
            --times \
            --partial \
            --info=progress \
                "${escaped}" \
                raw/
    fi
done
