#!/usr/bin/env bash -euo pipefail
#
# Collect the raw footage from the capture laptop.

mapfile -t captures < \
    <( ssh ${CAPTURE_HOST} ls ${CAPTURE_DIR}/\*mkv 2>/dev/null )

for capture in "${captures[@]}"; do
    file="$(basename "$capture")"
    escaped="$(echo "$capture" | sed -e 's/ /\\ /g')"
    status "++ {green}$file"
    if [ -z "${DRY_RUN:-}" ]; then
        rsync \
            --inplace \
            --partial \
            --info=progress \
                "${CAPTURE_HOST}:$escaped" \
                raw/
    fi
done
